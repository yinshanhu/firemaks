(function(b){b.fn.firemaks=function(f){var e={main_window:null,mw_height:0,mw_width:0,canvas:null,context:null,aud_bang:null,aud_shake:null,sound_file_old:"",sound_file_child_old:"",gravity:3,lastfiretime:0,fireworks:new Array(),getLengthXXYY:function(d,j,c,i){return Math.sqrt(Math.abs(Math.pow((c-d),2)+Math.pow((i-j),2)))},getVectorDirection:function(c,j){var d={x:0,y:0};var i=0;i=c;if(c>90){i=180-c}if(c>180){i=c-180}if(c>270){i=360-c}d.x=Math.cos(e.inRad(i))*j;d.y=Math.sin(e.inRad(i))*j;if((c>90)&&(c<270)){d.x*=-1}if((c>0)&&(c<180)){d.y*=-1}if((c==90)||(c==270)){d.x=0}if((c==180)||(c==0)||(c==360)){d.y=0}return d},compareRGBs:function(d,c){if((d.r!=c.r)||(d.g!=c.g)||(d.b!=c.b)){return false}return true},genereateRGBstring:function(c){return c.r+","+c.g+","+c.b},inRad:function(c){return c*Math.PI/180},getRandomArbitary:function(d,c){return Math.random()*(c-d)+d},getRandomInt:function(d,c){return Math.floor(Math.random()*(c-d+1))+d},addfire:function(C,B,G,D,y,J,i){D=D||2;y=y||false;J=J||"random";i=i||1;switch(i){case 1:case 2:case 3:break;default:i=1;break}var z={x:C,y:B,rays:new Array(),die:0,timebegin:b.now(),maxlt:0,type:i};var K=G;var I=y;var E=false;for(var L=0;L<K;L++){var x={r:0,g:0,b:0};if((typeof(J)=="string")&&(J=="random")){x.r=e.getRandomInt(0,255);x.g=e.getRandomInt(0,255);x.b=e.getRandomInt(0,255)}if(typeof(J)=="object"){x=J}if(b.isArray(J)){x=J[e.getRandomInt(0,J.length-1)]}E=false;if(I>0){E=true;I--}var d=e.getRandomInt(0,359);var A=e.getRandomInt((D*1000)/2,D*(1000)+300);if(z.maxlt<A){z.maxlt=A}var H=e.getRandomArbitary(0.35,0.85);var c=e.getVectorDirection(d,10);c.x=c.x/2;c.y=c.y/2;var F={x:C,y:B,islife:true,lifetime:A,color:x,angle:d,power:c,speed:H,boom:E,trace:new Array()};z.rays.push(F)}e.fireworks.push(z);return z}};var a={init:function(c){this.firemaks.settings=b.extend({},this.firemaks.defaults,c);return this.each(function(){e.main_window=b(this);e.mw_height=b(window).height();e.mw_width=b(window).width();e.aud_bang=new Audio();e.aud_shake=new Audio();if(b(this).firemaks.settings.sound_file!=""){e.aud_bang.src=b(this).firemaks.settings.sound_file}if(b(this).firemaks.settings.sound_file_child!=""){e.aud_shake.src=b(this).firemaks.settings.sound_file_child}e.sound_file_old=b(this).firemaks.settings.sound_file;e.sound_file_child_old=b(this).firemaks.settings.sound_file_child;var d=b("<canvas />",{id:"fmkscnvs"});d.attr({width:e.mw_width-2+"px",height:e.mw_height-2+"px"});d.css({position:"fixed","z-index":9999,"pointer-events":"none"});e.canvas=d;e.context=b(e.canvas)[0].getContext("2d");e.main_window.prepend(e.canvas);b(window).resize(function(){e.mw_height=b(window).height();e.mw_width=b(window).width();e.canvas.attr({width:e.mw_width-2+"px",height:e.mw_height-2+"px"})});setInterval(function(){e.context.clearRect(0,0,e.mw_width,e.mw_height);if(e.sound_file_old!=b(this).firemaks.settings.sound_file){e.aud_bang.src=b(this).firemaks.settings.sound_file;e.sound_file_old=b(this).firemaks.settings.sound_file}if(e.sound_file_child_old!=b(this).firemaks.settings.sound_file_child){e.aud_shake.src=b(this).firemaks.settings.sound_file_child;e.sound_file_child_old=b(this).firemaks.settings.sound_file_child}if(b(this).firemaks.settings.fire!=null){e.fireworks.push(b(this).firemaks.settings.fire);b(this).firemaks.settings.fire=null;if(b(this).firemaks.settings.sound){if(b(this).firemaks.settings.sound_file!=""){var F=e.aud_bang.cloneNode(true);F.play()}}}var i=0;if(b(this).firemaks.settings.boom_time_from==b(this).firemaks.settings.boom_time_to){i=b(this).firemaks.settings.boom_time_from}else{i=e.getRandomInt(b(this).firemaks.settings.boom_time_from*1000,b(this).firemaks.settings.boom_time_to*1000)}if((b.now()-e.lastfiretime)>=i){var j={r:235,g:235,b:255};if((typeof(b(this).firemaks.settings.color)=="string")&&(b(this).firemaks.settings.color=="random")){j.r=e.getRandomInt(0,255);j.g=e.getRandomInt(0,255);j.b=e.getRandomInt(0,255)}if((typeof(b(this).firemaks.settings.color)=="string")&&(b(this).firemaks.settings.color=="full_random")){j="random"}if(typeof(b(this).firemaks.settings.color)=="object"){j=b(this).firemaks.settings.color}if(b.isArray(b(this).firemaks.settings.color)){if(b.isArray(b(this).firemaks.settings.color[0])){j=b(this).firemaks.settings.color[e.getRandomInt(0,b(this).firemaks.settings.color.length-1)]}else{j=b(this).firemaks.settings.color}}var B="random";if((typeof(b(this).firemaks.settings.type)=="string")&&(b(this).firemaks.settings.type=="random")){B=e.getRandomInt(1,3)}if(typeof(b(this).firemaks.settings.type)=="number"){B=parseInt(b(this).firemaks.settings.type);if((B<1)||(B>3)){B="random"}}var A=0;var z=0;if(b(this).firemaks.settings.decrease_for_mobile){z=e.getRandomInt(15,50);A=e.getRandomInt(0,3)}else{z=e.getRandomInt(45,160);A=e.getRandomInt(0,5)}if(e.fireworks.length<b(this).firemaks.settings.boom_count){e.addfire(e.getRandomInt(20,e.mw_width-20),e.getRandomInt(20,e.mw_height-20),z,e.getRandomInt(1,4),A,j,B);if(b(this).firemaks.settings.sound){if(b(this).firemaks.settings.sound_file!=""){var F=e.aud_bang.cloneNode(true);F.play()}}}e.lastfiretime=b.now()}if(e.fireworks.length!=0){for(var w=0;w<e.fireworks.length;w++){for(var x=0;x<e.fireworks[w].rays.length;x++){if(e.fireworks[w].rays[x].islife){var y=false;if(e.fireworks[w].type==3){y=e.getRandomInt(0,100);if((y>=0)&&(y<=50)){y=true}else{y=false}}if(!y){e.context.beginPath();e.context.shadowBlur=0;e.context.shadowOffsetX=0;e.context.shadowOffsetY=0;e.context.shadowColor="";e.context.beginPath();e.context.fillStyle="rgba("+e.fireworks[w].rays[x].color.r+","+e.fireworks[w].rays[x].color.g+","+e.fireworks[w].rays[x].color.b+",1)";e.context.arc(e.fireworks[w].rays[x].x,e.fireworks[w].rays[x].y,1,0,2*Math.PI);e.context.fill();if(e.fireworks[w].rays[x].trace.length>0){e.context.moveTo(e.fireworks[w].rays[x].trace[0][0],e.fireworks[w].rays[x].trace[0][1]);e.context.strokeStyle="rgba("+e.fireworks[w].rays[x].color.r+","+e.fireworks[w].rays[x].color.g+","+e.fireworks[w].rays[x].color.b+","+(1/2)+")";for(var E=1;E<e.fireworks[w].rays[x].trace.length;E++){e.context.lineTo(e.fireworks[w].rays[x].trace[E][0],e.fireworks[w].rays[x].trace[E][1]);e.context.stroke();e.context.moveTo(e.fireworks[w].rays[x].trace[E][0],e.fireworks[w].rays[x].trace[E][1]);e.context.strokeStyle="rgba("+e.fireworks[w].rays[x].color.r+","+e.fireworks[w].rays[x].color.g+","+e.fireworks[w].rays[x].color.b+","+(1/E)+")"}}e.context.closePath()}e.fireworks[w].rays[x].x+=e.fireworks[w].rays[x].power.x*e.fireworks[w].rays[x].speed;e.fireworks[w].rays[x].y+=e.fireworks[w].rays[x].power.y*e.fireworks[w].rays[x].speed;if(e.fireworks[w].type==2){if(e.fireworks[w].rays[x].trace.length>=5){e.fireworks[w].rays[x].trace.pop()}e.fireworks[w].rays[x].trace.unshift(new Array(e.fireworks[w].rays[x].x,e.fireworks[w].rays[x].y))}if((b.now()-e.fireworks[w].timebegin)>(e.fireworks[w].maxlt/4)){if(e.fireworks[w].rays[x].power.x>0){if((e.fireworks[w].rays[x].power.x-0.1)<0){e.fireworks[w].rays[x].power.x=0}else{e.fireworks[w].rays[x].power.x-=0.1}}if(e.fireworks[w].rays[x].power.x<0){if((e.fireworks[w].rays[x].power.x+0.1)>0){e.fireworks[w].rays[x].power.x=0}else{e.fireworks[w].rays[x].power.x+=0.1}}if(e.fireworks[w].rays[x].power.y<e.gravity){e.fireworks[w].rays[x].power.y+=0.2}}if((b.now()-e.fireworks[w].timebegin)>e.fireworks[w].rays[x].lifetime){e.fireworks[w].rays[x].islife=false;if(b(this).firemaks.settings.child_boom){if((e.fireworks[w].rays[x].boom)&&((e.fireworks[w].rays[x].x>0)&&(e.fireworks[w].rays[x].x<e.mw_width))&&((e.fireworks[w].rays[x].y>0)&&(e.fireworks[w].rays[x].y<e.mw_height))){var D={r:235,g:235,b:255};if((typeof(b(this).firemaks.settings.color_child)=="string")&&(b(this).firemaks.settings.color_child=="random")){D.r=e.getRandomInt(0,255);D.g=e.getRandomInt(0,255);D.b=e.getRandomInt(0,255)}if((typeof(b(this).firemaks.settings.color_child)=="string")&&(b(this).firemaks.settings.color_child=="full_random")){D="random"}if((typeof(b(this).firemaks.settings.color_child)=="string")&&(b(this).firemaks.settings.color_child=="inherit")){D=e.fireworks[w].rays[x].color}if(typeof(b(this).firemaks.settings.color_child)=="object"){D=b(this).firemaks.settings.color_child}if(b.isArray(b(this).firemaks.settings.color_child)){if(b.isArray(b(this).firemaks.settings.color_child[0])){D=b(this).firemaks.settings.color_child[e.getRandomInt(0,b(this).firemaks.settings.color_child.length-1)]}else{D=b(this).firemaks.settings.color_child}}var t="random";if((typeof(b(this).firemaks.settings.type_child)=="string")&&(b(this).firemaks.settings.type_child=="random")){t=e.getRandomInt(1,3)}if((typeof(b(this).firemaks.settings.type_child)=="string")&&(b(this).firemaks.settings.type_child=="inherit")){t=e.fireworks[w].type}if(typeof(b(this).firemaks.settings.type_child)=="number"){t=parseInt(b(this).firemaks.settings.type_child);if((t<1)||(t>3)){t="random"}}var C=0;if(b(this).firemaks.settings.decrease_for_mobile){C=e.getRandomInt(10)}else{C=30}e.addfire(e.fireworks[w].rays[x].x,e.fireworks[w].rays[x].y,C,1,0,D,t);if(b(this).firemaks.settings.sound){if(b(this).firemaks.settings.sound_file_child!=""){var F=e.aud_shake.cloneNode(true);F.play()}}}}e.fireworks[w].die++}}}if(e.fireworks[w].rays.length==e.fireworks[w].die){e.fireworks.splice(w,1);w--}}}},50)})},fire:function(d,n,l,m,k,c){l=l||35;m=m||"full_random";k=k||0;c=c||1.5;return this.each(function(){if((typeof(m)=="string")&&(m=="random")){m={r:e.getRandomInt(0,255),g:e.getRandomInt(0,255),b:e.getRandomInt(0,255)}}if((typeof(m)=="string")&&(m=="full_random")){m="random"}if(typeof(m)=="object"){m=m}if(b.isArray(m)){if(b.isArray(m[0])){m=m[e.getRandomInt(0,m.length-1)]}else{m=m}}if((typeof(k)=="string")&&(k=="random")){k=e.getRandomInt(1,3)}if(typeof(k)=="number"){k=parseInt(k);if((k<1)||(k>3)){k="random"}}var g=e.addfire(d,n,l,c,0,m,k);b(this).firemaks.settings.fire=g})},settimeofboom:function(d,c){d=d||null;c=c||null;if((d==null)&&(c==null)){b(this).firemaks.settings.boom_time_from=b(this).firemaks.defaults.boom_time_from;b(this).firemaks.settings.boom_time_to=b(this).firemaks.defaults.boom_time_to;return false}if(d==null){b(this).firemaks.settings.boom_time_from=1.5}if(c==null){b(this).firemaks.settings.boom_time_to=4}if(d<=c){b(this).firemaks.settings.boom_time_from=d;b(this).firemaks.settings.boom_time_to=c;return true}else{b(this).firemaks.settings.boom_time_from=1.5;b(this).firemaks.settings.boom_time_to=4}},setcountof:function(c){if((c>0)&&(c<=10)){b(this).firemaks.settings.boom_count=parseInt(c)}else{b(this).firemaks.settings.boom_count=b(this).firemaks.defaults.boom_count}},setchilds:function(c){c=c||true;if(c){b(this).firemaks.settings.child_boom=true}else{b(this).firemaks.settings.child_boom=false}},settypes:function(c,d){c=c||null;d=d||null;if(c!=null){b(this).firemaks.settings.type=c}else{b(this).firemaks.settings.type=b(this).firemaks.defaults.type}if(d!=null){b(this).firemaks.settings.type_child=d}else{b(this).firemaks.settings.type_child=b(this).firemaks.defaults.type_child}},setcolors:function(c,d){c=c||null;d=d||null;if(c!=null){b(this).firemaks.settings.color=c}else{b(this).firemaks.settings.color=b(this).firemaks.defaults.color}if(d!=null){b(this).firemaks.settings.color_child=d}else{b(this).firemaks.settings.color_child=b(this).firemaks.defaults.color_child}},setsounds:function(c,d){c=c||"";d=d||"";if((c=="")&&(d=="")){if(b(this).firemaks.settings.sound){b(this).firemaks.settings.sound=false}return false}b(this).firemaks.settings.sound=true;b(this).firemaks.settings.sound_file=c;b(this).firemaks.settings.sound_file_child=d;return true}};if(a[f]){return a[f].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof f==="object"||!f){return a.init.apply(this,arguments)}else{b.error('Method "'+f+'" does not exist in firemaks plugin!')}}};b.fn.firemaks.defaults={fire:null,decrease_for_mobile:false,boom_count:2,type:"random",color:"random",child_boom:true,type_child:"inherit",color_child:"inherit",sound:false,sound_file:"",sound_file_child:"",boom_time_from:1.5,boom_time_to:4};b.fn.firemaks.settings={}})(jQuery);